doctype html
html(lang='en')
  head
    title Dive Log
    meta(charset='utf-8')
    meta(http-equiv='X-UA-Compatible',content='IE=edge')
    meta(name='description',content='')
    meta(name='viewport',content='initial-scale=1,maximum-scale=1,user-scalable=no')
    link(rel='stylesheet',href='/angular-material/angular-material.css')
    link(rel='stylesheet',href='http://fonts.googleapis.com/css?family=Roboto:300,400,500,700,400italic')
    link(rel='stylesheet',href='https://fonts.googleapis.com/icon?family=Material+Icons')
    style.
      .card {
        max-width: 400px;
        margin: auto;
        margin-top: 24px;
      }
      #parentPanel {
        overflow: hidden;
        background-color: #424242;    /* Grey 800 */
      }
      .selected {
        background-color: #e0e0e0;    /* Grey 300 */
      }
  body(ng-app='myApp',layout='column',ng-controller='DiveLogController')
    md-toolbar
      .md-toolbar-tools
        | Younderwater Dive Log
    md-content(layout='row',flex)
      md-content(layout='column', flex=33)
        md-list
          md-list-item.md-3-line(
            ng-repeat='dive in dives'
            ng-click='setDive(dive)'
            ng-class="{'selected': dive == selectedDive}"
          )
            .md-list-item-text
              h3 {{dive.site}}
              h4 {{dive.location}}
              p {{dive.depth}} feet | {{dive.time}} min
              md-divider
      md-content#parentPanel(flex)
        md-card.card(ng-click='showBottomSheet($event)')
          img.md-card-image(
            alt='{{selectedDive.site}}'
            ng-src='images/{{selectedDive.image}}'
          )
          md-card-content
            h1 {{selectedDive.depth}} feet | {{selectedDive.time}} min
            h2 {{selectedDive.site}}
            h3 {{selectedDive.location}}
          md-card-footer
            span.tag(ng-repeat='tag in dive.tags') {{tag.toString()}}
    script(src='/angular/angular.js')
    script(src='/angular-animate/angular-animate.js')
    script(src='/angular-aria/angular-aria.js')
    script(src='/angular-material/angular-material.js')
    script
      :coffee-script
        angular.module 'divelog', []
        .controller 'DiveLogController', [
          '$scope'
          '$mdBottomSheet'
          '$mdToast'
          ($scope, $mdBottomSheet, $mdToast) ->
            $scope.dives = [{
              site:       "Abu Gotta Ramada"
              location:   "Hurghada, Egypt"
              depth:      30
              time:       82
              tags:       ["shallow"]
              image:      '1.jpg'
            },{
              site:       "Small Giftun"
              location:   "Hurghada, Egypt"
              depth:      78
              time:       54
              tags:       ["deep"]
              image:      '2.jpg'
            },{
              site:       "Fanous East"
              location:   "Hurghada, Egypt"
              depth:      38
              time:       55
              tags:       ["shallow", "drift"]
              image:      '3.jpg'
            },{
              site:       "Umm Gamar"
              location:   "Hurghada, Egypt"
              depth:      102
              time:       48
              tags:       ["deep", "wreck"]
              image:      '4.jpg'
            },{
              site:       "Paradise"
              location:   "Sharm El Sheikh, Egypt"
              depth:      34
              time:       62
              tags:       ["shallow"]
              image:      '5.jpg'
            },{
              site:       "Near Garden"
              location:   "Sharm El Sheikh, Egypt"
              depth:      47
              time:       43
              tags:       ["manta"]
              image:      '6.jpg'
            },{
              site:       "Far Garden"
              location:   "Sharm El Sheikh, Egypt"
              depth:      72
              time:       48
              tags:       ["manta"]
              image:      '7.jpg'
            },{
              site:       "Shark & Yolanda Reef"
              location:   "Ras Mohamed, Egypt"
              depth:      49
              time:       57
              tags:       ["drift", "wreck", "shark"]
              image:      '8.jpg'
            },{
              site:       "Dunraven"
              location:   "Ras Mohamed, Egypt"
              depth:      56
              time:       49
              tags:       ["wreck"]
              image:      '9.jpg'
            },{
              site:       "Ponte Mahoon"
              location:   "Maehbourg, Mauritius"
              depth:      54
              time:       38
              tags:       ["manta"]
              image:      '10.jpg'
            },{
              site:       "Shark Rock"
              location:   "Coco Beach, Mauritius"
              depth:      88
              time:       32
              tags:       ["deep", "shark"]
              image:      '11.jpg'
            },{
              site:       "Urchin City"
              location:   "Coco Beach, Mauritius"
              depth:      39
              time:       58
              tags:       ["shallow"]
              image:      '12.jpg'
            },{
              site:       "Molnar Cave"
              location:   "Budapest, Hungary"
              depth:      98
              time:       62
              tags:       ["cave", "deep"]
              image:      '13.jpg'
            },{
              site:       "Ecsed Lake"
              location:   "Ecsed, Hungary"
              depth:      24
              time:       102
              tags:       ["shallow", "lake"]
              image:      '14.jpg'
            },{
              site:       "Gyekenyes Lake"
              location:   "Ecsed, Hungary"
              depth:      31
              time:       44
              tags:       ["shallow", "night", "lake"]
              image:      '15.jpg'
            }]

            $scope.selectedDive = $scope.dives[0]
            $scope.setDive = (dive) ->
              $scope.selectedDive = dive
              $mdBottomSheet.cancel()
            $scope.showBottomSheet = (ev) ->
              parentPanel = angular.element(
                document.querySelector('#parentPanel')
              )
              $mdBottomSheet.show(
                templateUrl: 'bottom08.html'
                controller: 'BottomSheetController'
                parent: parentPanel
                targetEvent: ev
                locals: {dive: $scope.selectedDive}
                bindToController: true
                controllerAs: 'ctrl'
              )
              .then (response) ->
                toast = $mdToast.simple()
                .content response
                .position 'top right'
                .hideDelay 3000
                $mdToast.show toast
            true
        ]

        .controller 'BottomSheetController', [
          '$scope'
          '$mdBottomSheet'
          ($scope, $mdBottomSheet) ->
            $scope.actions = [{
              name: "Share with buddies"
              icon: 'share'
              color: '#1565C0'
              done: "Shared with your buddies."
            },{
              name: "Print"
              icon: 'print'
              color: '#1b5e20'
              done: "Printed to the default printer."
            },{
              name: "Mark as favorite"
              icon: 'favorite'
              color: '#F44336'
              done: "Marked as favorite."
            }]
            $scope.doAction = (message) ->
              $mdBottomSheet.hide message
            true
        ]

        angular.module 'myApp', ['ngMaterial', 'divelog']
